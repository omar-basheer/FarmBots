#!/usr/bin/env pybricks-micropython

# Before running this program, make sure the client and server EV3 bricks are
# paired using Bluetooth, but do NOT connect them. The program will take care
# of establishing the connection.

# The server must be started before the client!
import farm_helpers
from pybricks.messaging import BluetoothMailboxServer, TextMailbox
from pybricks import ev3brick as brick

server = BluetoothMailboxServer()
mbox = TextMailbox('greeting', server)

# The server must be started before the client!
print('waiting for connection...')
server.wait_for_connection()
print('connected!')

# In this program, the server waits for the client to send the first message
# and then sends a reply.
mbox.wait()
received_message = mbox.read()
print(received_message)

# mbox.send('Earth to Mars, this is Earth ')

# Create and initialize the farm space matrix
# farm_space = farm_helpers.initialize_farm_space()
# mbox.close()
brick.display.text(received_message)
